# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

This is Tobias Maier's Dev Container Features collection - a repository for creating and distributing custom development container features following the [Dev Container Features specification](https://containers.dev/implementors/features/). Features are self-contained, reusable units that add tooling, runtimes, or libraries to development containers.

## Key Commands

### Testing Features
```bash
# Install devcontainer CLI (required for testing)
npm install -g @devcontainers/cli

# Test all features against multiple base images
devcontainer features test --skip-scenarios -f <feature-name> -i <base-image> .

# Test specific feature scenarios
devcontainer features test -f <feature-name> --skip-autogenerated --skip-duplicated .

# Test global scenarios (multiple features together)
devcontainer features test --global-scenarios-only .
```

### Validation
```bash
# Validate all devcontainer-feature.json files
devcontainer features validate ./src
```

### Feature Development
- Each feature requires a `devcontainer-feature.json` metadata file and `install.sh` script
- Features are located in `src/<feature-name>/` directories
- Test scenarios go in `test/<feature-name>/` directories
- Global test scenarios go in `test/_global/`

## Architecture

### Feature Structure
```
src/
├── <feature-name>/
│   ├── devcontainer-feature.json    # Feature metadata, options, versioning
│   ├── install.sh                   # Installation script (runs as root)
│   └── README.md                    # Feature documentation (optional)
```

### Feature Metadata (`devcontainer-feature.json`)
- **Required fields**: `id`, `name`, `version` (semver)
- **Optional fields**: `description`, `options`, `installsAfter`, `dependsOn`
- Options are passed as environment variables to install.sh (capitalized and sanitized)

### Testing Structure
```
test/
├── _global/                         # Global scenarios (multiple features)
│   ├── scenarios.json              # Test configuration
│   └── *.sh                        # Test scripts
├── <feature-name>/                  # Feature-specific tests
│   ├── scenarios.json
│   └── *.sh
```

## Development Workflow

1. **Create Feature**: Add new directory in `src/` with required files
2. **Define Options**: Configure in `devcontainer-feature.json` 
3. **Implement Installation**: Write `install.sh` script
4. **Add Tests**: Create test scenarios in `test/<feature-name>/`
5. **Validate**: Run validation to check feature definitions
6. **Test**: Run feature tests against different base images

## Distribution

Features are automatically published to GitHub Container Registry (GHCR) via GitHub Actions:
- **Release workflow**: `.github/workflows/release.yaml` (manual trigger)
- **Namespace**: `ghcr.io/tmaier/devcontainer-features/<feature-name>:<version>`
- **Validation**: `.github/workflows/validate.yml` (on PRs)
- **Testing**: `.github/workflows/test.yaml` (on push/PR)

## Features provided

- `adr-tools` - Architecture Decision Records tools
- `chrome` - Google Chrome installation
- `imagemagick` - ImageMagick image processing tools
- `mc` - Midnight Commander file manager
- `yek` - Custom utility feature
- `yq` - YAML processing tool